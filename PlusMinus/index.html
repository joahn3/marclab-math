<!doctype html>
<html lang="ro">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>MarcLab ‚Üí PlusMinus (Neuro-Math)</title>
  <style>
    :root {
      --bg: #0f172a; --card: #1e293b; --line: rgba(255,255,255,0.1);
      --text: #f1f5f9; --muted: #94a3b8;
      --accent: #38bdf8; --gold: #facc15; --good: #4ade80; --bad: #fb7185;
      --radius: 22px; --font: system-ui, sans-serif;
    }
    * { box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }
    body {
      margin: 0; font-family: var(--font); background: var(--bg); color: var(--text);
      min-height: 100vh; display: flex; justify-content: center; padding: 14px;
    }
    .app { width: min(600px, 100%); display: flex; flex-direction: column; gap: 16px; }

    /* Top Bar */
    .top { display: flex; justify-content: space-between; align-items: center; background: var(--card); padding: 12px 16px; border-radius: var(--radius); border: 1px solid var(--line); }
    .stats { display: flex; gap: 8px; font-weight: 700; font-size: 14px; }
    .stat { color: var(--gold); }
    
    /* Main Card */
    .card { background: var(--card); border: 1px solid var(--line); border-radius: var(--radius); padding: 20px; min-height: 400px; display: flex; flex-direction: column; justify-content: space-between; position: relative; overflow: hidden;}
    
    /* Visualizations (Science Part) */
    .viz-container { display: flex; justify-content: center; gap: 16px; margin-bottom: 10px; min-height: 40px; }
    
    /* Dot Patterns (Dice style) */
    .dot-group { display: grid; grid-template-columns: repeat(2, 1fr); gap: 4px; width: 30px; }
    .d-pt { width: 8px; height: 8px; background: var(--muted); border-radius: 50%; opacity: 0.5; }
    .d-pt.active { background: var(--accent); opacity: 1; box-shadow: 0 0 5px var(--accent); }

    /* Ten Frame (Grila de 10) */
    .ten-frame { 
      display: grid; grid-template-columns: repeat(5, 1fr); grid-template-rows: repeat(2, 1fr);
      gap: 4px; padding: 4px; border: 2px solid var(--muted); border-radius: 8px; background: rgba(0,0,0,0.2);
    }
    .tf-dot { width: 16px; height: 16px; border-radius: 50%; background: transparent; border: 1px dashed rgba(255,255,255,0.1); }
    .tf-dot.filled { background: var(--good); border: none; box-shadow: 0 0 8px var(--good); }
    .tf-dot.empty { background: rgba(255,255,255,0.05); }

    /* Equation */
    .big-eq { 
      font-size: 48px; font-weight: 900; display: flex; align-items: center; justify-content: center; gap: 12px; 
      margin: 10px 0; flex-wrap: wrap;
    }
    .num-col { display: flex; flex-direction: column; align-items: center; gap: 8px; }
    .eqBox { 
      min-width: 80px; height: 70px; border: 2px solid var(--line); border-radius: 16px; 
      display: flex; align-items: center; justify-content: center; color: var(--accent); background: rgba(0,0,0,0.2);
    }
    .eqBox.filled { border-color: var(--accent); background: rgba(56, 189, 248, 0.15); }

    /* Keypad */
    .kbd { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; margin-top: auto; }
    .btn { 
      padding: 14px 0; border-radius: 12px; border: 1px solid var(--line); 
      background: rgba(255,255,255,0.05); color: white; font-size: 20px; font-weight: 700; cursor: pointer;
    }
    .btn:active { background: var(--accent); color: black; }
    .btn.del { grid-column: span 1; background: rgba(251, 113, 133, 0.2); color: var(--bad); }
    .btn.ok { grid-column: span 2; background: var(--good); color: #064e3b; }

    /* Feedback */
    .feedback { 
      position: absolute; inset: 0; background: rgba(15,23,42,0.95); z-index: 10;
      display: none; flex-direction: column; align-items: center; justify-content: center; text-align: center;
    }
    .fb-title { font-size: 32px; font-weight: 900; margin-bottom: 8px; }
  </style>
</head>
<body>

<div class="app">
  <div class="top">
    <div style="font-weight:800; color:var(--accent)">MarcLab v2.2</div>
    <div class="stats">
      <span>‚≠ê <span id="xp">0</span></span>
      <span class="stat">ü™ô <span id="coins">0</span></span>
    </div>
  </div>

  <div class="card">
    <div style="text-align:center; color:var(--muted); font-size:12px; font-weight:700; text-transform:uppercase" id="skillName">ADUNARE</div>
    
    <div id="problemArea" style="flex-grow:1; display:flex; flex-direction:column; justify-content:center;">
      </div>

    <div class="kbd">
      <button class="btn" onclick="input(1)">1</button>
      <button class="btn" onclick="input(2)">2</button>
      <button class="btn" onclick="input(3)">3</button>
      <button class="btn" onclick="input(4)">4</button>
      <button class="btn" onclick="input(5)">5</button>
      <button class="btn" onclick="input(6)">6</button>
      <button class="btn" onclick="input(7)">7</button>
      <button class="btn" onclick="input(8)">8</button>
      <button class="btn" onclick="input(9)">9</button>
      <button class="btn" onclick="input(0)">0</button>
      <button class="btn del" onclick="input('del')">‚å´</button>
      <button class="btn ok" onclick="check()">OK</button>
    </div>

    <div class="feedback" id="fbOverlay">
      <div class="fb-title" id="fbText">Corect!</div>
      <div style="color:var(--muted); margin-bottom:20px" id="fbSub"></div>
      <button class="btn ok" style="width:150px" onclick="nextRound()">ContinuƒÉ</button>
    </div>
  </div>
</div>

<script>
/**
 * MarcLab v2.2 - Neuro-Math Edition
 * Integrates Ten-Frames & Visual Scaffolding
 */

// --- Audio (Web Audio API) ---
const SFX = {
  ctx: new (window.AudioContext||window.webkitAudioContext)(),
  play: (freq, type, dur) => {
    const o=SFX.ctx.createOscillator(), g=SFX.ctx.createGain();
    o.type=type; o.frequency.value=freq; g.gain.exponentialRampToValueAtTime(0.01, SFX.ctx.currentTime+dur);
    o.connect(g); g.connect(SFX.ctx.destination); o.start(); o.stop(SFX.ctx.currentTime+dur);
  },
  win: () => { SFX.play(523,'sine',0.1); setTimeout(()=>SFX.play(784,'sine',0.3),100); },
  err: () => { SFX.play(150,'sawtooth',0.3); },
  tap: () => SFX.play(800,'sine',0.05)
};

// --- State ---
let state = { xp:0, coins:0, level:1 };
let curr = {}; 
let buf = "";

// --- Logic ---
function rand(min,max) { return Math.floor(Math.random()*(max-min+1))+min; }

function genProblem() {
  const types = ['add','sub','mk10','cmp'];
  const type = types[rand(0,3)];
  
  if(type === 'mk10') {
    const a = rand(1,9);
    return { type, a, b:10, ans:10-a, op:'+', txt:"C√¢t p√¢nƒÉ la 10?" };
  }
  if(type === 'add') {
    const a = rand(1,8), b = rand(1, 9-a);
    return { type, a, b, ans:a+b, op:'+', txt:"AdunƒÉ" };
  }
  if(type === 'sub') {
    const a = rand(2,9), b = rand(1,a);
    return { type, a, b, ans:a-b, op:'‚àí', txt:"Scade" };
  }
  // Compare
  const a = rand(1,10), b = rand(1,10);
  return { type:'cmp', a, b, ans: (a===b?'=':(a>b?'>':'<')), op:'?', txt:"ComparƒÉ (< = >)" };
}

// --- Rendering Visuals (The Science Part) ---
function renderTenFrame(n, color='var(--good)') {
  let html = `<div class="ten-frame">`;
  for(let i=1; i<=10; i++) {
    const cls = i <= n ? 'filled' : 'empty';
    const style = i <= n ? `background:${color}` : '';
    html += `<div class="tf-dot ${cls}" style="${style}"></div>`;
  }
  html += `</div>`;
  return html;
}

function renderDots(n) {
  if(n > 10) return ""; // Too many for simple dots
  let html = `<div class="dot-group">`;
  for(let i=0; i<n; i++) html += `<div class="d-pt active"></div>`;
  html += `</div>`;
  return html;
}

function renderProblem() {
  const p = curr;
  document.getElementById('skillName').innerText = p.txt;
  const area = document.getElementById('problemArea');
  
  // 1. Vizualizare (Scaffolding)
  let vizHTML = "";
  if(p.type === 'mk10') {
    // Show Ten Frame populated with A
    vizHTML = `<div style="display:flex;justify-content:center;margin-bottom:20px">
      ${renderTenFrame(p.a)}
    </div>`;
  } else if (p.type === 'add' || p.type === 'sub') {
    // Show small dots under numbers to help bridge concrete -> abstract
    vizHTML = `
      <div class="viz-container">
        ${renderDots(p.a)}
        <div style="width:20px"></div>
        ${p.type==='add' ? renderDots(p.b) : ''}
      </div>
    `;
  }

  // 2. Abstract (Numbers)
  let eqHTML = "";
  if(p.type === 'mk10') {
    eqHTML = `
      <div class="big-eq">
        <span>${p.a}</span><span>+</span><div class="eqBox" id="box">?</div><span>=</span><span>10</span>
      </div>`;
  } else if (p.type === 'cmp') {
     // For compare, use Keypad logic modification needed, but keeping simple for now
     // Note: comparison usually needs specific buttons < = >, here we focus on numbers for v2.2
     // Fallback to simple add if cmp selected randomly but keypad is numeric.
     // Let's force Numeric Comparison: "Which is bigger?" -> type number? 
     // For simplicity in this snippets, let's skip CMP rendering update and stick to numeric inputs.
     // *Self-correction*: Let's stick to Math operations for this visual update.
     curr = genProblem(); if(curr.type==='cmp') curr.type='add'; // force add/sub for demo
     renderProblem(); return;
  } else {
    eqHTML = `
      <div class="big-eq">
        <div class="num-col"><span>${p.a}</span></div>
        <span>${p.op}</span>
        <div class="num-col"><span>${p.b}</span></div>
        <span>=</span>
        <div class="eqBox" id="box">?</div>
      </div>`;
  }

  area.innerHTML = vizHTML + eqHTML;
}

// --- Interaction ---
function input(v) {
  SFX.tap();
  if(v==='del') buf = buf.slice(0,-1);
  else if(buf.length < 2) buf += v;
  document.getElementById('box').innerText = buf || "?";
  if(buf) document.getElementById('box').classList.add('filled');
  else document.getElementById('box').classList.remove('filled');
}

function check() {
  if(!buf) return;
  const val = parseInt(buf);
  const correct = (val === curr.ans);
  
  const fb = document.getElementById('fbOverlay');
  const txt = document.getElementById('fbText');
  
  fb.style.display = 'flex';
  
  if(correct) {
    SFX.win();
    state.xp += 10; state.coins += 1;
    txt.innerText = "Corect! üåü";
    txt.style.color = "var(--good)";
    document.getElementById('xp').innerText = state.xp;
    document.getElementById('coins').innerText = state.coins;
  } else {
    SFX.err();
    txt.innerText = "Mai √ÆncearcƒÉ";
    txt.style.color = "var(--bad)";
    document.getElementById('fbSub').innerHTML = `RƒÉspunsul era <b>${curr.ans}</b>`;
  }
}

function nextRound() {
  document.getElementById('fbOverlay').style.display = 'none';
  buf = "";
  curr = genProblem();
  renderProblem();
}

// Start
nextRound();

</script>
</body>
</html>

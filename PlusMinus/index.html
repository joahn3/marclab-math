<!doctype html>
<html lang="ro">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>MarcLab v2.0 ‚Üí Cosmic Math</title>
  <meta name="description" content="MarcLab v2.0. Sunete, Level 2 (10-20), Trecere peste ordin." />
  <style>
    :root {
      /* Cosmic Theme Palette */
      --bg: #0f172a; /* Deep Space Blue */
      --card: #1e293b;
      --card-border: rgba(124, 58, 237, 0.3); /* Purple tint */
      --text: #f1f5f9;
      --muted: #94a3b8;
      
      --accent: #38bdf8; /* Cyan */
      --accent-glow: rgba(56, 189, 248, 0.35);
      
      --gold: #facc15; /* Stars/Coins */
      --good: #4ade80; /* Green Neon */
      --bad: #f87171;  /* Red Neon */
      --warn: #fb923c; /* Orange */
      
      --shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.6);
      --radius: 24px;
      --font-main: system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif;
    }

    * { box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }
    
    body {
      margin: 0; font-family: var(--font-main);
      background: 
        radial-gradient(circle at 15% 10%, rgba(124, 58, 237, 0.15) 0%, transparent 40%),
        radial-gradient(circle at 85% 80%, rgba(56, 189, 248, 0.1) 0%, transparent 40%),
        var(--bg);
      color: var(--text);
      min-height: 100vh;
      display: flex; flex-direction: column; align-items: center;
      padding: 14px;
    }

    /* Layout */
    .app { width: min(1000px, 100%); display: flex; flex-direction: column; gap: 16px; }
    
    /* Top Bar */
    .top {
      display: flex; flex-wrap: wrap; gap: 12px; justify-content: space-between; align-items: center;
      background: rgba(30, 41, 59, 0.7);
      backdrop-filter: blur(10px);
      padding: 12px 16px; border-radius: var(--radius);
      border: 1px solid rgba(255,255,255,0.08);
      box-shadow: var(--shadow);
    }
    .brand { display: flex; flex-direction: column; }
    .brand b { font-size: 18px; color: var(--accent); letter-spacing: -0.02em; }
    .brand span { font-size: 12px; color: var(--muted); }

    .stats { display: flex; gap: 8px; flex-wrap: wrap; }
    .stat-pill {
      background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1);
      padding: 6px 12px; border-radius: 99px;
      font-size: 13px; font-weight: 700;
      display: flex; align-items: center; gap: 6px;
    }
    .stat-pill.gold { color: var(--gold); border-color: rgba(250, 204, 21, 0.3); }
    .stat-pill.xp { color: var(--accent); }

    /* Level Selector Toggle */
    .lvl-toggle {
      display: inline-flex; background: rgba(0,0,0,0.4); 
      padding: 4px; border-radius: 99px; border: 1px solid rgba(255,255,255,0.1);
    }
    .lvl-btn {
      background: transparent; border: none; color: var(--muted);
      padding: 6px 14px; border-radius: 99px; font-size: 12px; font-weight: 700;
      cursor: pointer; transition: all 0.2s ease;
    }
    .lvl-btn.active { background: var(--accent); color: #0f172a; box-shadow: 0 2px 10px var(--accent-glow); }

    /* Main Grid */
    .main { display: grid; grid-template-columns: 1.4fr 0.8fr; gap: 16px; margin-top: 4px; }
    @media(max-width: 850px){ .main { grid-template-columns: 1fr; } }

    .card {
      background: var(--card); border: 1px solid var(--card-border);
      border-radius: var(--radius); padding: 20px;
      box-shadow: var(--shadow); position: relative;
      overflow: hidden;
    }
    /* Subtle glow effect on cards */
    .card::before {
      content:''; position: absolute; top:0; left:0; right:0; height: 1px;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
    }

    /* Problem Area */
    .prompt-container { min-height: 400px; display: flex; flex-direction: column; justify-content: space-between; }
    
    .question-row { 
      display: flex; flex-direction: column; align-items: center; justify-content: center; 
      flex-grow: 1; gap: 20px; padding: 20px 0;
    }
    
    .big-eq {
      font-size: clamp(40px, 8vw, 64px); font-weight: 800;
      display: flex; align-items: center; gap: 16px; flex-wrap: wrap; justify-content: center;
      text-shadow: 0 4px 12px rgba(0,0,0,0.5);
    }
    
    .box {
      min-width: 100px; height: 80px; padding: 0 16px;
      background: rgba(0,0,0,0.3); border: 2px solid rgba(255,255,255,0.2);
      border-radius: 16px; display: flex; align-items: center; justify-content: center;
      color: var(--accent);
    }
    .box.filled { border-color: var(--accent); background: rgba(56, 189, 248, 0.1); }

    /* Dots Visualization */
    .dots-viz { display: flex; gap: 12px; flex-wrap: wrap; justify-content: center; max-width: 320px; }
    .dot-item {
      width: 24px; height: 24px; border-radius: 50%;
      background: var(--accent); box-shadow: 0 0 10px var(--accent-glow);
    }
    .dot-item.ghost { background: transparent; border: 2px solid rgba(255,255,255,0.2); box-shadow: none; }

    /* Keypad */
    .kbd { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; max-width: 400px; margin: 0 auto; width: 100%; }
    .btn {
      background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
      color: var(--text); padding: 18px; border-radius: 16px;
      font-size: 22px; font-weight: 700; cursor: pointer;
      transition: transform 0.1s, background 0.2s;
      box-shadow: 0 4px 0 rgba(0,0,0,0.3);
    }
    .btn:active { transform: translateY(4px); box-shadow: none; }
    .btn.action { font-size: 16px; background: rgba(248, 113, 113, 0.15); border-color: rgba(248, 113, 113, 0.3); color: #fca5a5; }
    .btn.primary { background: rgba(56, 189, 248, 0.15); border-color: rgba(56, 189, 248, 0.3); color: var(--accent); grid-column: span 1; }

    /* Feedback Overlay */
    .feedback-overlay {
      position: absolute; inset: 0; 
      background: rgba(15, 23, 42, 0.95);
      backdrop-filter: blur(8px);
      display: none; flex-direction: column; align-items: center; justify-content: center;
      z-index: 10; animation: fadeIn 0.2s ease;
    }
    @keyframes fadeIn { from{opacity:0} to{opacity:1} }
    
    .fb-icon { font-size: 60px; margin-bottom: 10px; }
    .fb-title { font-size: 24px; font-weight: 800; margin-bottom: 8px; }
    .fb-sub { color: var(--muted); margin-bottom: 24px; }
    
    .btn-next {
      background: var(--good); color: #064e3b; border: none;
      padding: 16px 32px; font-size: 20px; font-weight: 800;
      border-radius: 99px; box-shadow: 0 0 20px rgba(74, 222, 128, 0.4);
      cursor: pointer;
    }

    /* Side Panel */
    .skill-row {
      display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px solid rgba(255,255,255,0.05);
    }
    .skill-name { font-weight: 600; font-size: 14px; }
    .skill-bar { width: 80px; height: 6px; background: rgba(255,255,255,0.1); border-radius: 4px; overflow: hidden; }
    .skill-fill { height: 100%; background: var(--accent); transition: width 0.5s ease; }

    /* Dialogs */
    dialog {
      background: #1e293b; color: var(--text); border: 1px solid rgba(255,255,255,0.1);
      border-radius: 20px; padding: 24px; width: min(500px, 90vw);
      box-shadow: 0 20px 50px rgba(0,0,0,0.8);
    }
    dialog::backdrop { background: rgba(0,0,0,0.7); backdrop-filter: blur(2px); }
    input, textarea {
      width: 100%; background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1);
      color: white; padding: 12px; border-radius: 12px; margin: 8px 0; font-family: monospace;
    }
    .row-btns { display: flex; gap: 10px; margin-top: 16px; justify-content: flex-end; }

    /* Toast */
    .toast {
      position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
      background: var(--gold); color: #422006; font-weight: 800;
      padding: 10px 24px; border-radius: 99px;
      box-shadow: 0 10px 30px rgba(250, 204, 21, 0.4);
      opacity: 0; pointer-events: none; transition: opacity 0.3s;
      z-index: 100;
    }
    .toast.show { opacity: 1; bottom: 30px; }

  </style>
</head>
<body>

  <div class="app">
    <div class="top">
      <div class="brand">
        <b>MarcLab v2.0</b>
        <span>Cosmic Explorer</span>
      </div>
      
      <div class="lvl-toggle">
        <button class="lvl-btn active" id="btnLvl1" onclick="app.setLevel(1)">Level 1 (1-10)</button>
        <button class="lvl-btn" id="btnLvl2" onclick="app.setLevel(2)">Level 2 (10-20)</button>
      </div>

      <div class="stats">
        <div class="stat-pill xp">XP <span id="uiXp">0</span></div>
        <div class="stat-pill gold">ü™ô <span id="uiCoins">0</span></div>
        <div class="stat-pill">üî• <span id="uiStreak">0</span></div>
      </div>
    </div>

    <div class="main">
      <div class="card prompt-container">
        
        <div style="display:flex; justify-content:space-between; align-items:center">
          <span style="font-size:12px; text-transform:uppercase; letter-spacing:1px; color:var(--muted); font-weight:700" id="uiSkillName">ADDITION</span>
          <button class="btn action" style="padding:8px 12px; font-size:12px;" onclick="app.toggleSound()" id="btnSound">üîä ON</button>
        </div>

        <div class="question-row" id="uiProblem">
          </div>

        <div class="kbd" id="uiKbd"></div>

        <div class="feedback-overlay" id="uiFeedback">
          <div class="fb-icon" id="fbIcon">‚≠ê</div>
          <div class="fb-title" id="fbTitle">Excelent!</div>
          <div class="fb-sub" id="fbSub">+10 XP</div>
          <button class="btn-next" onclick="app.newRound()" id="btnNext">UrmƒÉtorul</button>
        </div>
      </div>

      <div style="display:flex; flex-direction:column; gap:16px;">
        <div class="card">
          <h3 style="margin:0 0 16px; font-size:16px; color:var(--accent)">AbilitƒÉ»õi (Progres)</h3>
          <div id="uiSkills"></div>
        </div>

        <div class="card">
          <h3 style="margin:0 0 10px; font-size:16px; color:var(--muted)">Centru de ComandƒÉ</h3>
          <button class="btn primary" style="width:100%; font-size:14px; padding:12px;" onclick="app.parentGate()">Dashboard PƒÉrinte üîí</button>
        </div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast">Level Up! +50 Coins</div>

  <dialog id="parentDlg">
    <h3 style="margin-top:0">Dashboard PƒÉrinte</h3>
    <p style="font-size:13px; color:var(--muted)">SetƒÉri avansate »ôi backup.</p>
    <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:16px">
      <button class="btn action" onclick="app.resetAll()">Reset TOTAL</button>
      <button class="btn action" style="color:var(--gold); border-color:var(--gold)" onclick="app.addCoins()">+100 Coins</button>
      <button class="btn" style="font-size:14px" onclick="app.exportData()">Export JSON</button>
      <label class="btn" style="font-size:14px; display:flex; align-items:center; justify-content:center">
        Import
        <input type="file" onchange="app.importData(this)" style="display:none" accept=".json">
      </label>
    </div>
    <div class="row-btns">
      <button class="btn primary" onclick="document.getElementById('parentDlg').close()">√énchide</button>
    </div>
  </dialog>

<script>
/**
 * MarcLab v2.0 - Sound Engine & Logic
 */
const SFX = (() => {
  let ctx = null;
  let enabled = true;

  function init() {
    if (!ctx) ctx = new (window.AudioContext || window.webkitAudioContext)();
  }

  function playTone(freq, type, dur, vol = 0.1) {
    if (!enabled || !ctx) return;
    const osc = ctx.createOscillator();
    const gain = ctx.createGain();
    osc.type = type;
    osc.frequency.setValueAtTime(freq, ctx.currentTime);
    gain.gain.setValueAtTime(vol, ctx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + dur);
    osc.connect(gain);
    gain.connect(ctx.destination);
    osc.start();
    osc.stop(ctx.currentTime + dur);
  }

  return {
    toggle: () => { enabled = !enabled; if(enabled) init(); return enabled; },
    correct: () => {
      init();
      playTone(523.25, 'sine', 0.1); // C5
      setTimeout(() => playTone(659.25, 'sine', 0.2), 100); // E5
      setTimeout(() => playTone(783.99, 'sine', 0.4), 200); // G5
    },
    wrong: () => {
      init();
      playTone(150, 'sawtooth', 0.4, 0.2);
      setTimeout(() => playTone(130, 'sawtooth', 0.4, 0.2), 150);
    },
    levelup: () => {
      init();
      [523, 659, 783, 1046].forEach((f, i) => setTimeout(() => playTone(f, 'square', 0.3, 0.1), i * 150));
    },
    click: () => {
      init(); playTone(800, 'sine', 0.05, 0.05);
    }
  };
})();

/**
 * Game Logic
 */
const app = (() => {
  const STORAGE_KEY = 'marclab_v2_cosmic';
  
  let state = {
    meta: { v: 2 },
    settings: { level: 1, sound: true }, // Level 1 (1-10), Level 2 (10-20)
    user: { xp: 0, coins: 0, streak: 0, bestStreak: 0 },
    skills: {
      // Level 1 Skills
      l1_add: { lvl:1, mastery:0.5 },
      l1_sub: { lvl:1, mastery:0.5 },
      l1_cmp: { lvl:1, mastery:0.5 },
      // Level 2 Skills
      l2_add: { lvl:1, mastery:0.3 }, // Bridging 10
      l2_sub: { lvl:1, mastery:0.3 },
      l2_ord: { lvl:1, mastery:0.4 }  // Ordering/Comparing up to 20
    }
  };

  let currentProb = null;
  let locked = false;

  // --- Core Functions ---

  function load() {
    const raw = localStorage.getItem(STORAGE_KEY);
    if (raw) {
      const s = JSON.parse(raw);
      if(s.meta && s.meta.v === 2) state = s;
    }
    renderUI();
    newRound();
  }

  function save() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
  }

  function rand(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }

  function genProblem() {
    const lvl = state.settings.level;
    const skills = lvl === 1 
      ? ['l1_add', 'l1_sub', 'l1_cmp'] 
      : ['l2_add', 'l2_sub', 'l2_ord'];
    
    // Pick skill based on lowest mastery (adaptive)
    skills.sort((a,b) => state.skills[a].mastery - state.skills[b].mastery);
    // 60% chance to pick weakest, 40% random
    const skillKey = Math.random() < 0.6 ? skills[0] : skills[rand(0, skills.length-1)];
    
    let p = { skill: skillKey, q: '', ans: '', type: 'kbd' }; // default type

    if (skillKey === 'l1_add') {
      const a = rand(1, 8); const b = rand(1, 10-a);
      p.a = a; p.b = b; p.op = '+'; p.ans = a+b; p.viz = 'add';
    } else if (skillKey === 'l1_sub') {
      const a = rand(2, 10); const b = rand(1, a);
      p.a = a; p.b = b; p.op = '‚àí'; p.ans = a-b; p.viz = 'sub';
    } else if (skillKey === 'l1_cmp') {
      const a = rand(1, 10); const b = rand(1, 10);
      if(a===b && Math.random()>.3) return genProblem(); // Retry to avoid too many equals
      p.a = a; p.b = b; p.op = '?'; p.ans = a===b ? '=' : (a>b ? '>' : '<'); p.type = 'cmp';
    } 
    // Level 2 Logic
    else if (skillKey === 'l2_add') {
      // Logic: Sum > 10 but <= 20
      const a = rand(6, 9);
      const b = rand(11-a + 1, 9); // ensure sum > 10
      p.a = a; p.b = b; p.op = '+'; p.ans = a+b; p.viz = 'none';
    } else if (skillKey === 'l2_sub') {
      // Logic: Crossing 10 (e.g., 13 - 5)
      const a = rand(11, 18);
      const b = rand(a-9, 9); // ensure result < 10 typically, or just simple
      p.a = a; p.b = b; p.op = '‚àí'; p.ans = a-b; p.viz = 'none';
    } else if (skillKey === 'l2_ord') {
      const a = rand(10, 20); const b = rand(10, 20);
      if(a===b) return genProblem();
      p.a = a; p.b = b; p.op = '?'; p.ans = a>b ? '>' : '<'; p.type = 'cmp';
    }

    return p;
  }

  // --- UI Rendering ---

  function renderUI() {
    // Stats
    document.getElementById('uiXp').textContent = state.user.xp;
    document.getElementById('uiCoins').textContent = state.user.coins;
    document.getElementById('uiStreak').textContent = state.user.streak;
    
    // Toggles
    document.getElementById('btnLvl1').className = state.settings.level === 1 ? 'lvl-btn active' : 'lvl-btn';
    document.getElementById('btnLvl2').className = state.settings.level === 2 ? 'lvl-btn active' : 'lvl-btn';
    document.getElementById('btnSound').textContent = state.settings.sound ? 'üîä ON' : 'üîá OFF';

    // Skills
    const list = document.getElementById('uiSkills');
    list.innerHTML = '';
    const relevantSkills = state.settings.level === 1 
      ? [['l1_add','AdunƒÉri 1-10'], ['l1_sub','ScƒÉderi 1-10'], ['l1_cmp','Comparare 1-10']]
      : [['l2_add','AdunƒÉri 10-20'], ['l2_sub','ScƒÉderi 10-20'], ['l2_ord','Comparare 10-20']];
      
    relevantSkills.forEach(([key, label]) => {
      const sk = state.skills[key];
      const pct = Math.round(sk.mastery * 100);
      list.innerHTML += `
        <div class="skill-row">
          <div class="skill-name">${label}</div>
          <div style="display:flex; align-items:center; gap:8px">
            <small style="color:var(--muted)">${pct}%</small>
            <div class="skill-bar"><div class="skill-fill" style="width:${pct}%"></div></div>
          </div>
        </div>`;
    });
  }

  function renderProblem() {
    const p = currentProb;
    const area = document.getElementById('uiProblem');
    const kbd = document.getElementById('uiKbd');
    const skillMap = {
      l1_add: 'Adunare (√éncepƒÉtor)', l1_sub: 'ScƒÉdere (√éncepƒÉtor)', l1_cmp: 'Comparare',
      l2_add: 'Adunare (Avansat)', l2_sub: 'ScƒÉdere (Avansat)', l2_ord: 'Ordonare Numere'
    };
    
    document.getElementById('uiSkillName').textContent = skillMap[p.skill] || 'EXERCI»öIU';

    // Render Question
    if(p.type === 'cmp') {
      area.innerHTML = `
        <div class="big-eq">
          <span>${p.a}</span>
          <div class="box">?</div>
          <span>${p.b}</span>
        </div>
        <small style="color:var(--accent); margin-top:10px">Care e rela»õia?</small>
      `;
    } else {
      // Standard Eq
      let vizHTML = '';
      if(p.viz === 'add') {
        let d1 = Array(p.a).fill('<div class="dot-item"></div>').join('');
        let d2 = Array(p.b).fill('<div class="dot-item ghost"></div>').join('');
        vizHTML = `<div class="dots-viz">${d1}${d2}</div>`;
      }
      
      area.innerHTML = `
        <div class="big-eq">
          <span>${p.a}</span>
          <span style="color:var(--muted)">${p.op}</span>
          <span>${p.b}</span>
          <span style="color:var(--muted)">=</span>
          <div class="box" id="ansBox">?</div>
        </div>
        ${vizHTML}
      `;
    }

    // Render KBD
    kbd.innerHTML = '';
    if(p.type === 'cmp') {
      ['<', '=', '>'].forEach(sym => {
        const b = document.createElement('button');
        b.className = 'btn'; b.textContent = sym;
        b.onclick = () => check(sym);
        kbd.appendChild(b);
      });
    } else {
      [1,2,3,4,5,6,7,8,9].forEach(n => {
        const b = document.createElement('button');
        b.className = 'btn'; b.textContent = n;
        b.onclick = () => handleInput(n);
        kbd.appendChild(b);
      });
      // 0 button
      const b0 = document.createElement('button'); b0.className = 'btn'; b0.textContent = '0';
      b0.onclick = () => handleInput(0);
      kbd.appendChild(b0);
      
      // Del button
      const del = document.createElement('button'); del.className = 'btn action'; del.textContent = '‚å´';
      del.onclick = () => handleInput('del');
      kbd.appendChild(del);
      
      // OK button
      const ok = document.createElement('button'); ok.className = 'btn primary'; ok.textContent = 'OK';
      ok.onclick = () => check(inputBuffer);
      kbd.appendChild(ok);
    }
  }

  let inputBuffer = '';
  function handleInput(val) {
    SFX.click();
    const box = document.getElementById('ansBox');
    if(val === 'del') {
      inputBuffer = inputBuffer.slice(0, -1);
    } else {
      if(inputBuffer.length < 2) inputBuffer += val;
    }
    box.textContent = inputBuffer || '?';
    box.classList.toggle('filled', inputBuffer.length > 0);
  }

  function check(val) {
    if(locked || val === '') return;
    locked = true;

    const isCorrect = String(val) === String(currentProb.ans);
    
    // Logic update
    const sk = state.skills[currentProb.skill];
    if(isCorrect) {
      SFX.correct();
      sk.mastery = Math.min(1, sk.mastery + 0.05);
      state.user.xp += 10;
      state.user.streak++;
      if(state.user.streak % 5 === 0) {
        state.user.coins += 5;
        showToast(`Streak ${state.user.streak}! +5 Coins`);
      }
    } else {
      SFX.wrong();
      sk.mastery = Math.max(0.1, sk.mastery - 0.05);
      state.user.streak = 0;
    }
    
    save();
    renderUI();
    showFeedback(isCorrect, currentProb.ans);
  }

  function showFeedback(ok, realAns) {
    const fb = document.getElementById('uiFeedback');
    const icon = document.getElementById('fbIcon');
    const title = document.getElementById('fbTitle');
    const sub = document.getElementById('fbSub');
    const btn = document.getElementById('btnNext');

    fb.style.display = 'flex';
    
    if(ok) {
      icon.textContent = 'üåü';
      title.textContent = 'Corect!';
      title.style.color = 'var(--good)';
      sub.textContent = `Ai acum ${state.user.xp} XP`;
      btn.style.background = 'var(--good)';
      btn.textContent = 'UrmƒÉtorul';
      btn.focus();
    } else {
      icon.textContent = 'ü§î';
      title.textContent = 'Mai √ÆncearcƒÉ!';
      title.style.color = 'var(--warn)';
      sub.innerHTML = `RƒÉspunsul era <b>${realAns}</b>`;
      btn.style.background = 'var(--warn)';
      btn.textContent = 'Am √Æn»õeles';
    }
  }

  function newRound() {
    document.getElementById('uiFeedback').style.display = 'none';
    inputBuffer = '';
    locked = false;
    currentProb = genProblem();
    renderProblem();
  }

  function showToast(msg) {
    const t = document.getElementById('toast');
    t.textContent = msg; t.classList.add('show');
    setTimeout(() => t.classList.remove('show'), 2000);
  }

  // --- Public API ---
  return {
    init: () => { load(); SFX.init(); },
    setLevel: (l) => { state.settings.level = l; save(); load(); },
    toggleSound: () => { state.settings.sound = SFX.toggle(); renderUI(); },
    newRound: newRound,
    
    // Parent Gate
    parentGate: () => {
      const pin = prompt("Introdu PIN-ul pƒÉrinte (default 2580):");
      if(pin === "2580") document.getElementById('parentDlg').showModal();
      else alert("PIN Incorect");
    },
    resetAll: () => { 
      if(confirm("Sigur »ôtergi tot?")) { 
        localStorage.removeItem(STORAGE_KEY); location.reload(); 
      }
    },
    addCoins: () => { state.user.coins += 100; save(); renderUI(); alert("Gata!"); },
    exportData: () => {
      const blob = new Blob([JSON.stringify(state)], {type: 'application/json'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob); a.download = 'marclab_save.json';
      a.click();
    },
    importData: (input) => {
      const f = input.files[0];
      if(!f) return;
      const r = new FileReader();
      r.onload = (e) => {
        try { state = JSON.parse(e.target.result); save(); location.reload(); }
        catch(err) { alert("Fi»ôier invalid"); }
      };
      r.readAsText(f);
    }
  };
})();

// Start
app.init();
</script>
</body>
</html>
